{% if wg_nat %}
{% if wg_ufw %}
{% else %}
{% endif %}
{% else %}
{% if wg_ufw %}
lias) }} out on wg0; ufw delete allow proto udp from any to any port {{ wg_port }}
{% else %}
PostUp = iptables -A FORWARD -o %i -j ACCEPT; 
PostDown = iptables -D FORWARD -o %i -j ACCEPT;
{% endif %}
{% endif%}


Didn't work
PostUp = iptables -t nat -A POSTROUTING -o {{ default_if | default(ansible_facts.default_ipv4.alias)  }} -j MASQUERADE; ip6tables -t nat -A POSTROUTING -o {{ default_if | default(ansible_facts.default_ipv4.alias)  }} -j MASQUERADE
PostDown = iptables -t nat -D POSTROUTING -o {{ default_if | default(ansible_facts.default_ipv4.alias)  }} -j MASQUERADE; ip6tables -t nat -D POSTROUTING -o {{ default_if | default(ansible_facts.default_ipv4.alias)  }} -j MASQUERADE


Doesn't work on VPS.
PostUp = iptables -A FORWARD -i {{  default_if | default(ansible_facts.default_ipv4.alias) }} -o wg0 -j ACCEPT; iptables -A FORWARD -i wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o {{  default_if | default(ansible_facts.default_ipv4.alias) }} -j MASQUERADE; ip6tables -w 9 -A FORWARD -i {{  default_if | default(ansible_facts.default_ipv4.alias) }} -o wg0 -j ACCEPT; ip6tables -w 9 -A FORWARD -i wg0 -j ACCEPT; ufw route allow in on wg0 out on {{  default_if | default(ansible_facts.default_ipv4.alias) }}; ufw route allow in on {{  default_if | default(ansible_facts.default_ipv4.alias) }} out on wg0; ufw allow proto udp from any to any port {{ wg_port }}
PostDown = iptables -D FORWARD -i {{  default_if | default(ansible_facts.default_ipv4.alias) }} -o wg0 -j ACCEPT; iptables -D FORWARD -i wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o {{  default_if | default(ansible_facts.default_ipv4.alias) }} -j MASQUERADE; ip6tables -w 9 -D FORWARD -i {{  default_if | default(ansible_facts.default_ipv4.alias) }} -o wg0 -j ACCEPT; ip6tables -w 9 -D FORWARD -i wg0 -j ACCEPT; ufw route delete allow in on wg0 out on {{  default_if | default(ansible_facts.default_ipv4.alias) }}; ufw route delete allow in on {{  default_if | default(ansible_facts.default_ipv4.alias) }} out on wg0; ufw delete allow proto udp from any to any port {{ wg_port }}


VPS works for IPV4 but not IPV6
PostUp = iptables -A FORWARD -i {{  default_if | default(ansible_facts.default_ipv4.alias) }} -o wg0 -j ACCEPT; iptables -A FORWARD -i wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o {{  default_if | default(ansible_facts.default_ipv4.alias) }} -j MASQUERADE; ip6tables -w 9 -A FORWARD -i {{  default_if | default(ansible_facts.default_ipv4.alias) }} -o wg0 -j ACCEPT; ip6tables -w 9 -A FORWARD -i wg0 -j ACCEPT; 
PostDown = iptables -D FORWARD -i {{  default_if | default(ansible_facts.default_ipv4.alias) }} -o wg0 -j ACCEPT; iptables -D FORWARD -i wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o {{  default_if | default(ansible_facts.default_ipv4.alias) }} -j MASQUERADE; ip6tables -w 9 -D FORWARD -i {{  default_if | default(ansible_facts.default_ipv4.alias) }} -o wg0 -j ACCEPT; ip6tables -w 9 -D FORWARD -i wg0 -j ACCEPT;  

Doesn't work on VPS
PostUp = iptables -A FORWARD -o %i -j ACCEPT; ufw route allow in on wg0 out on {{  default_if | default(ansible_facts.default_ipv4.alias) }}; ufw route allow in on {{  default_if | default(ansible_facts.default_ipv4.alias) }} out on wg0; ufw allow proto udp from any to any port {{ wg_port }}
PostDown = iptables -D FORWARD -o %i -j ACCEPT; ufw route delete allow in on wg0 out on {{  default_if | default(ansible_facts.default_ipv4.alias) }}; ufw route delete allow in on {{  default_if | default(ansible_facts.default_ipv4.a


# VPS with IPV4 and locallink IPv6
PostUp = {{ ['iptables -t nat -I POSTROUTING 1 -s ' + wg_ipv4_subnet + ' -o ' + default_if | default(ansible_facts.default_ipv4.alias) + ' -j MASQUERADE',
             'ip6tables -t nat -I POSTROUTING 1 -s ' + wg_ipv6_subnet + ' -o ' + default_if | default(ansible_facts.default_ipv4.alias) + ' -j MASQUERADE']
            | join('; ')}}
PostDown = {{ ['iptables -t nat -D POSTROUTING -s ' + wg_ipv4_subnet + ' -o ' + default_if | default(ansible_facts.default_ipv4.alias) + ' -j MASQUERADE',
               'ip6tables -t nat -D POSTROUTING -s ' + wg_ipv6_subnet + ' -o ' + default_if | default(ansible_facts.default_ipv4.alias) + ' -j MASQUERADE']
              | join('; ')}}


# VPS with IPv4 and IPv6 Addresses
PostUp = iptables -t nat -I POSTROUTING 1 -s {{ wg_ipv4_subnet }} -o {{ default_if | default(ansible_facts.default_ipv4.alias) }} -j MASQUERADE;{% for ip in wg_ipv6_addresses %}ip -6 neigh add proxy {{ ip }} dev {{ default_if | default(ansible_facts.default_ipv4.alias)}};{% endfor %}
PostDown = iptables -t nat -D POSTROUTING -s {{ wg_ipv4_subnet }} -o {{ default_if | default(ansible_facts.default_ipv4.alias) }} -j MASQUERADE;{% for ip in wg_ipv6_addresses %}ip -6 neigh del proxy {{ ip }} dev {{ default_if | default(ansible_facts.default_ipv4.alias)}};{% endfor %}

